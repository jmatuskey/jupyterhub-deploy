#! /bin/bash

set -eu

jupyter nbextension enable --py --sys-prefix  ipyvuetify
jupyter nbextension enable --py --sys-prefix  ipysplitpanes

jupyter labextension install \
       @jupyterlab/server-proxy \
       @jupyter-widgets/jupyterlab-manager \
        ipyevents \
        d3-selection-multi \
        jupyter-vuetify \
        bqplot

#         ipysplitpanes \    # ValueError: "ipysplitpanes" is not a valid npm package


jupyter lab build -y

# jupyter serverextension enable --sys-prefix jupyter_server_proxy

npm install --save jupyter-splitpanes
npm install --save jupyter-golden-layout
npm install --save bqplot-image-gl

# npm audit fix --force

# Skip cache clearing if buildkit caching is enabled or dev-mode is enabled.
if [[ "${CLEAR_PKG_CACHES}" == "1" ]]; then
    # Clear the lab and npm caches
    echo "-------------------------------------------------------------------------------"
    echo "===== Clearing jupyterlab and npm caches"
    jupyter lab clean -y
    npm cache clean --force
    rm -rf "/home/${NB_USER}/.cache/yarn"
    rm -rf "/home/${NB_USER}/.node-gyp"
fi
